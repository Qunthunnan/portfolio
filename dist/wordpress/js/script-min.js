window.addEventListener("DOMContentLoaded",()=>{function e(e,t){let s=0;if(t)do{s=Math.floor(10*Math.random())}while(s<e||s>t);else s=e;let n="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let e=0;e<s;e++){let e=Math.floor(Math.random()*o.length);n+=o.charAt(e)}return n}function t(t,s,n){let o;(!t||t>100||t<1||Math.floor(t)!=t)&&(t=50);let r=0;try{s.getDate(),n.getDate(),o=((e,t)=>{return i.getFreeLessonsByRange(e,t)})}catch(e){o=(()=>{return i.getFreeLessons()})}curentFreeLessons=o(s,n);for(let e in curentFreeLessons)r+=curentFreeLessons[e].getFreeSlotsCount();r*=t/100,r=Math.floor(r);for(let t=0;t<r;t++){let t=o(s,n)[Math.floor(Math.random()*o(s,n).length)].id;i.bookUser(e(3,10),`${e(5,10)}@mail.com`,t)}}function s(e,t,s,n){"number"==typeof e&&e>=0&&Math.round(e)==e?(this.id=e,t&&"string"==typeof t?(this.userName=t,s&&"string"==typeof s?(this.userEmail=s,"number"==typeof n&&n>=0&&Math.round(n)==n?this.userBookId=n:console.log("Lesson id is wrong")):console.log("Email formate is wrong , or not defined")):console.log("Name formate is wrong, or not defined")):console.log("User id is wrong")}function n(e,t,s,n){if("number"==typeof e&&e>=0&&Math.round(e)==e)if(this.id=e,t){this.lessonType=t;try{s.getDate()&&(this.lessonTime=new Date(s))}catch(e){return void console.log("lessonTime is empty or corrupted")}n&&"number"==typeof n&&Math.round(n)==n&&n>0?this.maxUsers=n:this.maxUsers=20,this.lessonUsers=[],this.isFree=function(){return this.lessonUsers.length<this.maxUsers},this.getFreeSlotsCount=function(){return this.maxUsers-this.lessonUsers.length},this.getLessonId=function(){return this.id},this.getLessonType=function(){return this.lessonType},this.getLessonTime=function(){return this.lessonTime},this.addUser=function(e){try{e.userName&&(this.isFree()?this.lessonUsers.push(e):console.log(`Lesson ${this.lessonTime} is full`))}catch(e){console.log("User data is broken")}}}else console.log("lesson type is empty");else console.log("Lesson id is wrong")}function o(e,t,s){e&&"string"==typeof e?(this.lessonType=e,t&&"string"==typeof t?(this.title=t,s&&"string"==typeof s?this.message=s:console.log("Lesson type message is wrong or emty. Allowed type for message - string")):console.log("Lesson type title is wrong or empty. Allowed type for title - string")):console.log("LessonType is wrong or empty. Allowed type for lessons - string")}const i=new function(e){this.availableLessonTypes=[];try{if("string"==typeof e[0].lessonType)for(let t in e)this.availableLessonTypes.push(e[t]);else this.availableLessonTypes.push(new o("junior","WordPress Junior","Підійде для новачків у сфері без досвіду у програмуванні. Усьому навчимо з нуля.")),this.availableLessonTypes.push(new o("middle","WordPress Middle","Підійде тим, хто має певний досвід. Починав навчатись, але не впевнений ще у своїх знаннях, хоче підтягнути їх.")),this.availableLessonTypes.push(new o("senior","WordPress Senior","Підійде тим, хто вже має комерційний досвід у сфері, але відчуває, що йому не достатньо знань для зросту у кар'єрі."))}catch(e){this.availableLessonTypes.push(new o("junior","WordPress Junior","Підійде для новачків у сфері без досвіду у програмуванні. Усьому навчимо з нуля.")),this.availableLessonTypes.push(new o("middle","WordPress Middle","Підійде тим, хто має певний досвід. Починав навчатись, але не впевнений ще у своїх знаннях, хоче підтягнути їх.")),this.availableLessonTypes.push(new o("senior","WordPress Senior","Підійде тим, хто вже має комерційний досвід у сфері, але відчуває, що йому не достатньо знань для зросту у кар'єрі."))}this.allUsers=[],this.lessons=[],this.getAvailableLessonTypes=function(){return this.availableLessonTypes},this.getFreeLessons=function(){let e=[];for(let t in this.lessons)this.lessons[t].isFree()&&e.push(this.lessons[t]);return e},this.getFreeLessonsByRange=function(e,t){let s=[];try{e.getDate()}catch(t){e=new Date}try{t.getDate()}catch{t=e.fp_incr(30)}for(let n in this.lessons)this.lessons[n].lessonTime.getTime()>=e.getTime()&&this.lessons[n].lessonTime.getTime()<=t.getTime()&&this.lessons[n].isFree()&&s.push(this.lessons[n]);return s},this.getFreeLessonsOnDay=function(e,t){let s=[];try{if(e.getDate()){let n=[];try{t[0].lessonTime.getDate();for(let e in t){if(!t[e].isFree())return void console.log("Lessons transferred to the method must be free for registration");n.push(t[e])}}catch(e){for(let e in this.getFreeLessons())n.push(this.getFreeLessons()[e])}for(let t in n)n[t].lessonTime.getDate()==e.getDate()&&n[t].lessonTime.getMonth()==e.getMonth()&&n[t].lessonTime.getFullYear()==e.getFullYear()&&s.push(n[t]);return s}}catch(e){return void console.log("iccorrect Date")}},this.getFilteredFreeLessons=function(e,t){let s;for(let t in this.availableLessonTypes)if(e==this.availableLessonTypes[t].lessonType){s=!0;break}if(s){let s=[];for(let t in this.lessons)this.lessons[t].lessonType===e&&this.lessons[t].isFree()&&s.push(this.lessons[t]);try{return t.getDate(),this.getFreeLessonsOnDay(t,s)}catch(e){return s}}else console.log(`lessonType is not recognized, try first .addNewLessonType('${e}');`)},this.getLessonsByDate=function(e){try{if(e.getDate()){let t=[];for(let s in this.lessons)(this.lessons[s].lessonTime=e)&&t.push(this.lessons[s])}}catch(e){return void console.log("iccorrect Date")}},this.isRegistered=function(e){try{if(e.userName){for(let t in this.allUsers)if(e.userEmail===this.allUsers[t].userEmail)return this.allUsers[t].id;return!1}}catch(e){return void console.log("User Data is corrupted")}},this.isExistsLesson=function(e){if("number"==typeof e&&e>=0&&Math.round(e)==e)return!!this.lessons[e]||(console.log("Lesson not founded by lesson Id"),!1);console.log("Lesson Id is icorrect")},this.bookUser=function(e,t,n){let o=new s(this.allUsers.length,e,t,n);try{if(o.userEmail){if(this.isExistsLesson(n)){if(this.lessons[n].isFree()){let e=this.isRegistered(o);return e?(console.log(`This user${this.allUsers[e].userEmail} is already registered on the lesson ${this.lessons[n].lessonTime}`),"registered"):(this.allUsers.push(o),this.lessons[n].addUser(o),!0)}return console.log(`Lesson ${this.lessons[n]} is full`),!1}return!1}return!1}catch(e){return!1}},this.addLesson=function(e,t,s){let o=new n(this.lessons.length,e,t,s);try{o.isFree(),this.lessons.push(o)}catch(e){}},this.addNewLessonType=function(e){try{"string"==typeof e.lessonType?this.availableLessonTypes.push(e):console.log("Wrong type of lesson type. Allowed type for lessons - string")}catch(e){console.log("Lesson type is icorrect")}}};let r=new Date,a=new Date((new Date).fp_incr(6).setHours(23,59,59,999)),l=(new Date).fp_incr(7),c=new Date((new Date).fp_incr(30).setHours(23,59,59,999));function d(e,t){let s=+window.getComputedStyle(e).opacity;if(s>=1)return e.style.opacity=1,clearInterval(G),G=null,void(null!=t&&t());s+=.03,e.style.opacity=s}function u(e,t){let s=+window.getComputedStyle(e).opacity;if(s<=0)return e.style.display="none",e.style.opacity=0,clearInterval(K),K=null,void(null!=t&&t());s-=.03,e.style.opacity=s}function m(e,t){"none"==window.getComputedStyle(e).display?(e.style.display="block",G||(G=null!=t?setInterval(d,10,e,t):setInterval(d,10,e))):K||(K=null!=t?setInterval(u,10,e,t):setInterval(u,10,e))}function g(e){X=!1,A.style.display="none",document.removeEventListener("click",g)}function w(e){let t=[];for(let s in i.getFilteredFreeLessons(e))t.push(i.getFilteredFreeLessons(e)[s].lessonTime);(Q=flatpickr(H,{locale:"uk",altInput:!0,altFormat:"j F, Y",dateFormat:"Y-m-d",minDate:"today",maxDate:(new Date).fp_incr(30),enable:t,appendTo:q})).config.onChange.push(function(t){se?se=!1:(R=t[0],ee?h(e,R):(ee=!0,function(e,t){E.classList.add("window-manager__window__choose-time_active"),h(e,t)}(e,R)))}),ee&&h(e,R)}function _(){E.classList.remove("window-manager__window__choose-time_active"),R=void 0,ee=!1,Q.value=""}function h(e,t){te&&(te=!1,J=void 0,p());let s=[];e:for(let n in i.getFilteredFreeLessons(e,t)){for(let o in s)if(s[o].lessonTime.getHours()===i.getFilteredFreeLessons(e,t)[n].lessonTime.getHours())continue e;s.push(i.getFilteredFreeLessons(e,t)[n])}if(s.length>0){C.innerHTML="";for(let e in s){let t=document.createElement("li");t.setAttribute("data-lessonid",`${s[e].id}`),`${s[e].lessonTime.getMinutes()}`.length>1?t.innerText=`${s[e].lessonTime.getHours()}:${s[e].lessonTime.getMinutes()}`:t.innerText=`${s[e].lessonTime.getHours()}:0${s[e].lessonTime.getMinutes()}`,t.addEventListener("click",e=>{y(e)}),C.append(t)}}else _()}function y(e){te?e.target.parentNode.querySelector(`[data-lessonid="${J}"]`).classList.remove("active"):(te=!0,$.forEach(e=>{e.classList.add(`${e.className}_active`)})),e.target.classList.add("active"),J=+e.target.getAttribute("data-lessonid"),console.log(J)}function p(){for(let e=$.length-1;e>=0;e--)$[e].classList.remove(`${$[e].classList[0]}_active`)}function f(e){if("name"===e.name){const t=/^[\s]*[^\!\@\#\$\%\^\&\*\=\+\~\`\{\}\[\]\\\|\'\"\;\:\/\?\.\>\,\<]*$/,s=2,n=256;return e.value.length>=s?e.value.length<=n?t.test(e.value)?(v(e),!0):(L(e,"Спеціальні символи, які можна використати:\n ( ) - _"),!1):(L(e,"Максимальна довжина імені: 255"),!1):(L(e,"Мінімальна довжина імені: 2"),!1)}if("email"===e.name){if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value))return v(e),!0;L(e,"Перевірте, чи правильно написана електронна адреса")}if("policy"===e.name){if(e.checked)return v(e),!0;L(e,"Потрібна ваша згода")}return!1}function L(e,t){if(!1==!!e.parentNode.querySelector(".window-manager__window__validation-error")){const s=document.createElement("label");s.htmlFor=e.id,s.className="window-manager__window__validation-error",s.innerText=t,e.parentNode.append(s)}else if(e.parentNode.querySelector(".window-manager__window__validation-error").innerText!==t){v(e);const s=document.createElement("label");s.htmlFor=e.id,s.className="window-manager__window__validation-error",s.innerText=t,e.parentNode.append(s)}}function v(e){e.parentNode.querySelector(".window-manager__window__validation-error")&&e.parentNode.querySelector(".window-manager__window__validation-error").remove()}function T(){p(),_(),te=!1,J=void 0,q.classList.remove("window-manager__window__choose-day_active"),Z=!1,ee=!1,R=void 0,X=!1,ne="",I.innerText="",Q.clear()}!function(e,t,s,n){try{for(e.getDate(),t.getDate(),(!s&&0!=s||s<0||"number"!=typeof s||Math.floor(s)!=s)&&(s=8),(!n||n<0||"number"!=typeof n||Math.floor(n)!=n)&&(n=19),genDate=new Date(new Date(e.getTime()+36e5).setMinutes(0,0,0));genDate.getTime()>=e.getTime()&&genDate.getTime()<=t.getTime();)genDate.getHours()>=s&&genDate.getHours()<=n&&i.addLesson(i.availableLessonTypes[Math.floor(Math.random()*i.availableLessonTypes.length)].lessonType,genDate),genDate=new Date(new Date(genDate.getTime()+36e5))}catch(e){console.log("Icorrect min or max date")}}(r,c),t(98,r,a),t(80,l,c),console.dir(i);const b=document.querySelector(".window-manager"),D=b.querySelector(".window-manager__window_book"),S=b.querySelector(".window-manager__window_booked"),F=b.querySelector(".window-manager__window_registered"),N=b.querySelector(".window-manager__window_error"),q=D.querySelector(".window-manager__window__choose-day"),E=D.querySelector(".window-manager__window__choose-time"),k=D.querySelector(".window-manager__window__name"),M=D.querySelector(".window-manager__window__email"),U=D.querySelector(".window-manager__window__submit"),x=D.querySelector(".window-manager__window__policy"),$=[k,M,U,x],A=D.querySelector(".window-manager__window__lesson-type__list"),I=D.querySelector(".window-manager__window__lesson-type-selected"),H=q.querySelector("#calendar"),C=E.querySelector(".window-manager__window__choose-time__list"),P=k.querySelector("#name"),W=M.querySelector("#email"),Y=x.querySelector("#policy"),O=b.querySelectorAll(".book-btn_submit"),j=b.querySelectorAll(".window-manager__window__close"),B=document.querySelectorAll(".book-btn");let R,J,z,G,K,Q=flatpickr(H,{locale:"uk",altInput:!0,altFormat:"j F, Y",dateFormat:"Y-m-d",minDate:"today",maxDate:(new Date).fp_incr(30),appendTo:q}),V=!1,X=!1,Z=!1,ee=!1,te=!1,se=!1,ne="";document.querySelector(".first-web-time").innerHTML=`${i.lessons[0].lessonTime.toLocaleDateString("uk-UA",{month:"long",day:"numeric",hour:"numeric",minute:"numeric"})} за київським часом`,B.forEach(e=>{"book-btn_submit"!==e.classList[1]&&e.addEventListener("click",e=>{V||(V=!0,m(b))})}),function(){let e=[];for(let t in i.getAvailableLessonTypes())e.push(i.getAvailableLessonTypes()[t]);for(let t in e){let s=document.createElement("li");s.className="window-manager__window__lesson-type__item",s.setAttribute("data-course-type",e[t].lessonType);let n=document.createElement("div");n.className="window-manager__window__lesson-type__title",n.innerText=`${e[t].title}`,s.append(n);let o=document.createElement("div");o.className="window-manager__window__lesson-type__message",o.innerText=`${e[t].message}`,s.append(o),A.append(s)}z=b.querySelectorAll(".window-manager__window__lesson-type__item"),lessonTypeListMessages=b.querySelectorAll(".window-manager__window__lesson-type__message")}(),I.addEventListener("click",e=>{!function(e){A.style.display="flex"}(),X?(X=!1,A.style.display="none"):(X=!0,document.addEventListener("click",e=>{e.target.className!=I.className&&g()}))}),z.forEach(e=>{e.addEventListener("mouseenter",e=>{"window-manager__window__lesson-type__item"!=e.target.parentNode.className&&e.target.querySelector(".window-manager__window__lesson-type__message").classList.toggle("window-manager__window__lesson-type__message_active")}),e.addEventListener("mouseleave",e=>{"window-manager__window__lesson-type__item"!=e.target.parentNode.className&&e.target.querySelector(".window-manager__window__lesson-type__message").classList.toggle("window-manager__window__lesson-type__message_active")}),e.addEventListener("click",e=>{let t;(t="window-manager__window__lesson-type__item"===e.target.className?e.target:e.target.parentNode).parentNode.parentNode.querySelector(".window-manager__window__lesson-type-selected").innerText=t.querySelector(".window-manager__window__lesson-type__title").innerText,ne=t.getAttribute("data-course-type"),Z?w(ne):function(e){Z=!0,q.classList.add("window-manager__window__choose-day_active"),w(e)}(ne)})}),P.addEventListener("input",e=>{f(e.target)}),Y.addEventListener("input",e=>{f(e.target)}),W.addEventListener("input",e=>{f(e.target)}),O.forEach(e=>{"window-manager__window__form"===e.parentNode.parentNode.classList[0]&&e.addEventListener("click",e=>{e.preventDefault();const t=f(P),s=f(W),n=f(Y);if(t&&s&&n){let e=i.bookUser(P.value,W.value,J);if(console.log(i),se=!0,!0===e){S.querySelector(".window-manager__window__descr").innerText=`Дякую, що записались, ваш вебінар відбудеться:\n ${i.lessons[J].lessonTime.toLocaleDateString("uk-UA",{month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}. Посилання на вебінар прийде на електронну пошту.😊`;const e={name:P.value,email:W.value,lessonDate:i.lessons[J].lessonTime.toLocaleDateString("uk-UA",{month:"long",day:"numeric",hour:"numeric",minute:"numeric"})};try{fetch("mailer/smart.php",{method:"POST",body:JSON.stringify(e)})}catch{}document.querySelector(".window-manager__window__form").reset(),m(D,()=>{m(S,T)})}else"registered"===e&&m(D,()=>{m(F,T)}),!1===e&&m(D,()=>{m(N,T)})}}),e.parentNode.parentNode.classList[1]!==S.classList[1]&&e.parentNode.parentNode.classList[1]!==F.classList[1]||e.addEventListener("click",e=>{!function(e,t){m(e),m(t)}(e.target.parentNode.parentNode,D)})}),j.forEach(e=>{let t=function e(t,s){try{if(t.parentNode.classList[0]===s)return t.parentNode;e(t.parentNode,s)}catch(e){return}}(e,"window-manager__window");t.classList[1]===D.classList[1]&&e.addEventListener("click",e=>{V=!1,m(b)}),t.classList[1]!==S.classList[1]&&t.classList[1]!==F.classList[1]&&t.classList[1]!==N.classList[1]||e.addEventListener("click",e=>{V=!1,m(t,()=>{!function(e,t){e.style.display="none",e.style.opacity=0,t.style.display="block",t.style.opacity=1}(b,D)})})})});